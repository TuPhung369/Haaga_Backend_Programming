<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Assistants - TuPhung Project Documentation</title>
  <link rel="stylesheet" href="../../css/style.css">
  <!-- Mermaid for flowcharts -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.0/dist/mermaid.min.js"></script>
  <!-- Prism for code highlighting -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
</head>
<body>
  <button class="menu-toggle">â˜°</button>
  
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>TuPhung Project</h1>
    </div>
    
    <nav class="sidebar-nav">
      <div class="sidebar-section">
        <div class="sidebar-section-title">Overview</div>
        <ul class="sidebar-subnav">
          <li class="sidebar-subnav-item">
            <a href="../../index.html" class="sidebar-subnav-link">Introduction</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../architecture.html" class="sidebar-subnav-link">Architecture</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../tech-stack.html" class="sidebar-subnav-link">Tech Stack</a>
          </li>
        </ul>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title">Frontend</div>
        <ul class="sidebar-subnav">
          <li class="sidebar-subnav-item">
            <a href="structure.html" class="sidebar-subnav-link">Project Structure</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="auth.html" class="sidebar-subnav-link">Authentication</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="user-management.html" class="sidebar-subnav-link">User Management</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="chat.html" class="sidebar-subnav-link">Chat System</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="kanban.html" class="sidebar-subnav-link">Kanban Board</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="calendar.html" class="sidebar-subnav-link">Calendar</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="ai-assistants.html" class="sidebar-subnav-link active">AI Assistants</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="language-ai.html" class="sidebar-subnav-link">Language AI</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="state-management.html" class="sidebar-subnav-link">State Management</a>
          </li>
        </ul>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title">Backend</div>
        <ul class="sidebar-subnav">
          <li class="sidebar-subnav-item">
            <a href="../backend/structure.html" class="sidebar-subnav-link">Project Structure</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../backend/auth.html" class="sidebar-subnav-link">Authentication & Security</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../backend/user-management.html" class="sidebar-subnav-link">User Management</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../backend/database.html" class="sidebar-subnav-link">Database Design</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../backend/api.html" class="sidebar-subnav-link">API Endpoints</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../backend/websockets.html" class="sidebar-subnav-link">WebSockets</a>
          </li>
          <li class="sidebar-subnav-item">
            <a href="../backend/speech-processing.html" class="sidebar-subnav-link">Speech Processing</a>
          </li>
        </ul>
      </div>
    </nav>
  </aside>
  
  <main class="main-content">
    <header class="content-header">
      <h1>AI Assistants</h1>
      <p>Comprehensive documentation of the AI Assistant features in the TuPhung Project.</p>
    </header>
    
    <section>
      <h2>Overview</h2>
      <p>
        The AI Assistants feature in the TuPhung Project provides intelligent virtual assistants that can help users 
        with various tasks, answer questions, and provide recommendations. The system leverages large language models 
        to understand natural language queries and generate helpful responses.
      </p>
      
      <div class="component-card">
        <h3>Key Features</h3>
        <ul>
          <li><strong>Natural Language Understanding</strong> - Process and understand user queries in natural language</li>
          <li><strong>Contextual Conversations</strong> - Maintain context throughout a conversation</li>
          <li><strong>Multiple Assistant Personas</strong> - Different assistants specialized for various tasks</li>
          <li><strong>Knowledge Base Integration</strong> - Access to project-specific information</li>
          <li><strong>Task Automation</strong> - Ability to perform actions on behalf of the user</li>
          <li><strong>Personalization</strong> - Adapt to user preferences and history</li>
          <li><strong>Rich Responses</strong> - Support for formatted text, code snippets, and markdown</li>
        </ul>
      </div>
      
      <h2>Architecture</h2>
      
      <div class="diagram-container">
        <div class="diagram-title">AI Assistant Architecture</div>
        <div class="mermaid">
          graph TD
            User[User] --> UI[AI Assistant UI]
            UI --> QueryProcessor[Query Processor]
            QueryProcessor --> ContextManager[Context Manager]
            QueryProcessor --> AIService[AI Service]
            
            AIService --> LLMProvider[LLM Provider API]
            ContextManager --> ConversationHistory[Conversation History]
            
            AIService --> KnowledgeBase[Knowledge Base]
            AIService --> ActionExecutor[Action Executor]
            
            ActionExecutor --> Calendar[Calendar Integration]
            ActionExecutor --> Tasks[Task Management]
            ActionExecutor --> Email[Email Integration]
            
            LLMProvider --> ResponseGenerator[Response Generator]
            ResponseGenerator --> UI
            
            subgraph Frontend
              UI
              QueryProcessor
              ResponseGenerator
            end
            
            subgraph Backend
              AIService
              ContextManager
              ConversationHistory
              KnowledgeBase
              ActionExecutor
              LLMProvider
            end
        </div>
      </div>
      
      <h2>Frontend Implementation</h2>
      
      <div class="component-card">
        <h3>Assistant AI Page Component</h3>
        <p>
          The main component that renders the AI Assistant interface and manages interactions.
        </p>
        <pre><code class="language-typescript">// src/pages/AssistantAIPage.tsx
import React, { useState, useEffect, useRef } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { Layout, Input, Button, Select, Typography, Avatar, Spin } from 'antd';
import { SendOutlined, RobotOutlined, UserOutlined } from '@ant-design/icons';
import { sendQuery, fetchAssistants, fetchConversationHistory } from '../services/assistantService';
import { setAssistants, setActiveAssistant, addMessage, setConversationHistory } from '../store/assistantAISlice';
import { RootState } from '../store/rootState';
import { AssistantMessage, Assistant } from '../types/AssistantAITypes';
import ReactMarkdown from 'react-markdown';
import { SparklesCore } from '../components/SparklesCore';
import '../styles/AssistantAI.css';

const { Header, Content, Sider } = Layout;
const { TextArea } = Input;
const { Title, Text } = Typography;
const { Option } = Select;

const AssistantAIPage: React.FC = () => {
  const dispatch = useDispatch();
  const { assistants, activeAssistant, messages, loading } = useSelector(
    (state: RootState) => state.assistantAI
  );
  const { user } = useSelector((state: RootState) => state.user);
  
  const [query, setQuery] = useState&lt;string&gt;('');
  const messagesEndRef = useRef&lt;HTMLDivElement&gt;(null);
  
  // Load assistants and conversation history on component mount
  useEffect(() => {
    const loadAssistants = async () => {
      try {
        const assistantList = await fetchAssistants();
        dispatch(setAssistants(assistantList));
        
        if (assistantList.length > 0 && !activeAssistant) {
          dispatch(setActiveAssistant(assistantList[0]));
        }
      } catch (error) {
        console.error('Failed to load assistants:', error);
      }
    };
    
    loadAssistants();
  }, [dispatch, activeAssistant]);
  
  // Load conversation history when active assistant changes
  useEffect(() => {
    if (activeAssistant) {
      const loadConversationHistory = async () => {
        try {
          const history = await fetchConversationHistory(activeAssistant.id);
          dispatch(setConversationHistory(history));
          scrollToBottom();
        } catch (error) {
          console.error('Failed to load conversation history:', error);
        }
      };
      
      loadConversationHistory();
    }
  }, [activeAssistant, dispatch]);
  
  // Scroll to bottom when messages change
  useEffect(() => {
    scrollToBottom();
  }, [messages]);
  
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };
  
  const handleSendQuery = async () => {
    if (!query.trim() || !activeAssistant) return;
    
    // Add user message to the conversation
    const userMessage: AssistantMessage = {
      id: Date.now().toString(),
      content: query,
      sender: 'user',
      timestamp: new Date().toISOString(),
      assistantId: activeAssistant.id
    };
    
    dispatch(addMessage(userMessage));
    setQuery('');
    
    try {
      // Send query to the backend
      const response = await sendQuery({
        assistantId: activeAssistant.id,
        query: query,
        userId: user?.id || ''
      });
      
      // Add assistant response to the conversation
      const assistantMessage: AssistantMessage = {
        id: response.id,
        content: response.content,
        sender: 'assistant',
        timestamp: response.timestamp,
        assistantId: activeAssistant.id
      };
      
      dispatch(addMessage(assistantMessage));
    } catch (error) {
      console.error('Failed to get assistant response:', error);
      
      // Add error message
      const errorMessage: AssistantMessage = {
        id: Date.now().toString(),
        content: 'Sorry, I encountered an error processing your request. Please try again later.',
        sender: 'assistant',
        timestamp: new Date().toISOString(),
        assistantId: activeAssistant.id,
        isError: true
      };
      
      dispatch(addMessage(errorMessage));
    }
  };
  
  const handleAssistantChange = (assistantId: string) => {
    const selected = assistants.find(assistant => assistant.id === assistantId);
    if (selected) {
      dispatch(setActiveAssistant(selected));
    }
  };
  
  const renderMessages = () => {
    return (
      &lt;div className="assistant-messages"&gt;
        {messages.map(message => (
          &lt;div
            key={message.id}
            className={`message-item ${message.sender === 'user' ? 'user-message' : 'assistant-message'} ${message.isError ? 'error-message' : ''}`}
          &gt;
            &lt;div className="message-avatar"&gt;
              &lt;Avatar
                icon={message.sender === 'user' ? &lt;UserOutlined /&gt; : &lt;RobotOutlined /&gt;}
                className={message.sender === 'user' ? 'user-avatar' : 'assistant-avatar'}
              /&gt;
            &lt;/div&gt;
            &lt;div className="message-content"&gt;
              &lt;div className="message-header"&gt;
                &lt;span className="message-sender"&gt;
                  {message.sender === 'user' ? user?.username || 'You' : activeAssistant?.name || 'Assistant'}
                &lt;/span&gt;
                &lt;span className="message-time"&gt;
                  {new Date(message.timestamp).toLocaleTimeString()}
                &lt;/span&gt;
              &lt;/div&gt;
              &lt;div className="message-text"&gt;
                &lt;ReactMarkdown&gt;{message.content}&lt;/ReactMarkdown&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        ))}
        
        {loading && (
          &lt;div className="message-item assistant-message"&gt;
            &lt;div className="message-avatar"&gt;
              &lt;Avatar icon={&lt;RobotOutlined /&gt;} className="assistant-avatar" /&gt;
            &lt;/div&gt;
            &lt;div className="message-content"&gt;
              &lt;div className="message-text typing-indicator"&gt;
                &lt;Spin size="small" /&gt; Thinking...
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}
        
        &lt;div ref={messagesEndRef} /&gt;
      &lt;/div&gt;
    );
  };
  
  return (
    &lt;Layout className="assistant-layout"&gt;
      &lt;Sider width={300} className="assistant-sider"&gt;
        &lt;div className="assistant-header"&gt;
          &lt;Title level={4}&gt;AI Assistants&lt;/Title&gt;
        &lt;/div&gt;
        
        &lt;div className="assistant-selection"&gt;
          &lt;Text strong&gt;Select an Assistant&lt;/Text&gt;
          &lt;Select
            value={activeAssistant?.id}
            onChange={handleAssistantChange}
            className="assistant-select"
          &gt;
            {assistants.map(assistant => (
              &lt;Option key={assistant.id} value={assistant.id}&gt;
                {assistant.name}
              &lt;/Option&gt;
            ))}
          &lt;/Select&gt;
        &lt;/div&gt;
        
        {activeAssistant && (
          &lt;div className="assistant-info"&gt;
            &lt;div className="assistant-avatar-container"&gt;
              &lt;Avatar
                size={80}
                icon={&lt;RobotOutlined /&gt;}
                className="assistant-large-avatar"
              /&gt;
              &lt;div className="assistant-sparkles"&gt;
                &lt;SparklesCore
                  background="transparent"
                  minSize={0.4}
                  maxSize={1}
                  particleDensity={20}
                  className="w-full h-full"
                  particleColor={activeAssistant.color || "#5EEAD4"}
                /&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;Title level={4} className="assistant-name"&gt;{activeAssistant.name}&lt;/Title&gt;
            &lt;Text type="secondary" className="assistant-description"&gt;
              {activeAssistant.description}
            &lt;/Text&gt;
            
            &lt;div className="assistant-capabilities"&gt;
              &lt;Text strong&gt;Capabilities:&lt;/Text&gt;
              &lt;ul&gt;
                {activeAssistant.capabilities.map((capability, index) => (
                  &lt;li key={index}&gt;{capability}&lt;/li&gt;
                ))}
              &lt;/ul&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}
      &lt;/Sider&gt;
      
      &lt;Layout className="assistant-content-layout"&gt;
        &lt;Content className="assistant-content"&gt;
          {activeAssistant ? (
            &lt;React.Fragment&gt;
              &lt;div className="messages-container"&gt;
                {renderMessages()}
              &lt;/div&gt;
              
              &lt;div className="query-input-container"&gt;
                &lt;TextArea
                  value={query}
                  onChange={e => setQuery(e.target.value)}
                  placeholder={`Ask ${activeAssistant.name} anything...`}
                  autoSize={{ minRows: 1, maxRows: 4 }}
                  onPressEnter={e => {
                    if (!e.shiftKey) {
                      e.preventDefault();
                      handleSendQuery();
                    }
                  }}
                /&gt;
                &lt;Button
                  type="primary"
                  icon={&lt;SendOutlined /&gt;}
                  onClick={handleSendQuery}
                  disabled={!query.trim() || loading}
                /&gt;
              &lt;/div&gt;
            &lt;/React.Fragment&gt;
          ) : (
            &lt;div className="no-assistant-selected"&gt;
              &lt;Title level={3}&gt;Select an AI Assistant&lt;/Title&gt;
              &lt;Text&gt;Choose an assistant from the sidebar to start a conversation.&lt;/Text&gt;
            &lt;/div&gt;
          )}
        &lt;/Content&gt;
      &lt;/Layout&gt;
    &lt;/Layout&gt;
  );
};</code></pre>
      </div>
      
      <h2>State Management</h2>
      
      <p>
        The AI Assistant feature uses Redux for state management, with a dedicated slice for assistant-related state.
      </p>
      
      <div class="component-card">
        <h3>Assistant AI State Slice</h3>
        <pre><code class="language-typescript">// src/store/assistantAISlice.ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';
import { Assistant, AssistantMessage } from '../types/AssistantAITypes';

interface AssistantAIState {
  assistants: Assistant[];
  activeAssistant: Assistant | null;
  messages: AssistantMessage[];
  loading: boolean;
  error: string | null;
}

const initialState: AssistantAIState = {
  assistants: [],
  activeAssistant: null,
  messages: [],
  loading: false,
  error: null
};

const assistantAISlice = createSlice({
  name: 'assistantAI',
  initialState,
  reducers: {
    setAssistants: (state, action: PayloadAction&lt;Assistant[]&gt;) => {
      state.assistants = action.payload;
    },
    setActiveAssistant: (state, action: PayloadAction&lt;Assistant&gt;) => {
      state.activeAssistant = action.payload;
    },
    setConversationHistory: (state, action: PayloadAction&lt;AssistantMessage[]&gt;) => {
      state.messages = action.payload;
    },
    addMessage: (state, action: PayloadAction&lt;AssistantMessage&gt;) => {
      state.messages.push(action.payload);
      
      if (action.payload.sender === 'user') {
        state.loading = true;
      } else {
        state.loading = false;
      }
    },
    clearMessages: (state) => {
      state.messages = [];
    },
    setLoading: (state, action: PayloadAction&lt;boolean&gt;) => {
      state.loading = action.payload;
    },
    setError: (state, action: PayloadAction&lt;string | null&gt;) => {
      state.error = action.payload;
      state.loading = false;
    }
  }
});

export const {
  setAssistants,
  setActiveAssistant,
  setConversationHistory,
  addMessage,
  clearMessages,
  setLoading,
  setError
} = assistantAISlice.actions;

export default assistantAISlice.reducer;</code></pre>
      </div>
      
      <h2>Backend Integration</h2>
      
      <p>
        The AI Assistant frontend communicates with the backend through a set of API services. These services 
        handle operations such as fetching available assistants, loading conversation history, and sending queries.
      </p>
      
      <div class="component-card">
        <h3>Assistant API Service</h3>
        <pre><code class="language-typescript">// src/services/assistantService.ts
import axios from 'axios';
import { API_BASE_URL } from '../config';
import { Assistant, AssistantMessage } from '../types/AssistantAITypes';

const API_URL = `${API_BASE_URL}/assistants`;

export const fetchAssistants = async (): Promise&lt;Assistant[]&gt; => {
  const response = await axios.get(`${API_URL}`);
  return response.data;
};

export const fetchAssistantById = async (assistantId: string): Promise&lt;Assistant&gt; => {
  const response = await axios.get(`${API_URL}/${assistantId}`);
  return response.data;
};

export const fetchConversationHistory = async (assistantId: string): Promise&lt;AssistantMessage[]&gt; => {
  const response = await axios.get(`${API_URL}/${assistantId}/history`);
  return response.data;
};

export const sendQuery = async (data: {
  assistantId: string;
  query: string;
  userId: string;
}): Promise&lt;AssistantMessage&gt; => {
  const response = await axios.post(`${API_URL}/${data.assistantId}/query`, {
    query: data.query,
    userId: data.userId
  });
  return response.data;
};

export const clearConversationHistory = async (assistantId: string): Promise&lt;void&gt; => {
  await axios.delete(`${API_URL}/${assistantId}/history`);
};</code></pre>
      </div>
      
      <h2>Types</h2>
      
      <p>
        The AI Assistant feature uses TypeScript interfaces to define the structure of assistants and messages.
      </p>
      
      <div class="component-card">
        <h3>Assistant AI Types</h3>
        <pre><code class="language-typescript">// src/types/AssistantAITypes.ts
export interface Assistant {
  id: string;
  name: string;
  description: string;
  capabilities: string[];
  color?: string;
  icon?: string;
  model: string;
  systemPrompt: string;
  createdAt: string;
  updatedAt: string;
}

export interface AssistantMessage {
  id: string;
  content: string;
  sender: 'user' | 'assistant';
  timestamp: string;
  assistantId: string;
  isError?: boolean;
  senderName?: string;
}

export interface QueryRequest {
  assistantId: string;
  query: string;
  userId: string;
}

export interface QueryResponse {
  id: string;
  content: string;
  timestamp: string;
}</code></pre>
      </div>
      
      <h2>Styling</h2>
      
      <p>
        The AI Assistant feature is styled using a combination of Ant Design components and custom CSS. The styling 
        focuses on providing a clean, intuitive interface that makes it easy to interact with the assistants.
      </p>
      
      <div class="component-card">
        <h3>Key Styling Features</h3>
        <ul>
          <li>Responsive layout that adapts to different screen sizes</li>
          <li>Clear visual distinction between user and assistant messages</li>
          <li>Animated typing indicators</li>
          <li>Particle effects for assistant avatars</li>
          <li>Markdown rendering for rich text responses</li>
          <li>Consistent spacing and alignment</li>
        </ul>
      </div>
      
      <h2>Backend Implementation</h2>
      
      <p>
        The backend implementation of the AI Assistant feature involves integrating with large language models (LLMs) 
        and managing conversation context. The system uses a combination of prompt engineering and context management 
        to provide intelligent responses.
      </p>
      
      <div class="component-card">
        <h3>Key Backend Components</h3>
        <ul>
          <li><strong>LLM Integration</strong> - Connection to language model providers</li>
          <li><strong>Context Management</strong> - Maintaining conversation history and context</li>
          <li><strong>Knowledge Base</strong> - Access to project-specific information</li>
          <li><strong>Action Execution</strong> - Ability to perform actions on behalf of the user</li>
          <li><strong>Response Generation</strong> - Processing LLM responses and formatting them for the frontend</li>
        </ul>
      </div>
      
      <h2>Future Enhancements</h2>
      
      <p>
        The AI Assistant feature is continuously evolving. Planned future enhancements include:
      </p>
      
      <div class="component-card">
        <h3>Upcoming Features</h3>
        <ul>
          <li><strong>Voice Interaction</strong> - Support for voice input and output</li>
          <li><strong>Multi-modal Capabilities</strong> - Ability to process and generate images</li>
          <li><strong>Advanced Personalization</strong> - Learning from user interactions to provide more tailored responses</li>
          <li><strong>Expanded Action Set</strong> - More integrations with other project features</li>
          <li><strong>Collaborative Assistants</strong> - Multiple assistants working together to solve complex problems</li>
        </ul>
      </div>
    </section>
  </main>
  
  <script src="../../assets/script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script>
    // Initialize syntax highlighting and mermaid diagrams
    document.addEventListener('DOMContentLoaded', (event) => {
      Prism.highlightAll();
      mermaid.initialize({ startOnLoad: true });
    });
  </script>
</body>
</html>